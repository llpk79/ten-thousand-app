# Copyright 2018 Paul Kutrich. All rights reserved.
#:kivy 1.10.1
#: import ScreenManager kivy.uix.screenmanager.ScreenManager
#: import colors colors.colors
#: import rgba kivy.utils.rgba


ScreenManager:
    id: screen_manager
    MenuScreen:
        id: menu
        name: 'menu'
        manager: 'screen_manager'
    PlayerNumberScreen:
        id: player_number
        name: 'number'
        manager: 'screen_manager'
    PlayerNameScreen:
        id: name
        name: 'name'
        manager: 'screen_manager'
    GameScreen:
        id: game
        name: 'game'
        manager: 'screen_manager'
    ResultsScreen:
        id: results
        name: 'results'
        manager: 'screen_manager'

<MenuScreen>
    name: 'menu'
    FloatLayout:
        Image:
            source: 'images/tabletop6.jpg'
            allow_stretch: True
            keep_ratio: False
        Label:
            text: 'Let\'s play some dice!'
            color: rgba(colors['text'])
            size_hint: (.2, .1)
            pos_hint: {'x': 0.4, 'y': 0.475}
            on_touch_down: root.parent.current = 'number'
            canvas.before:
                Color:
                    rgba: rgba(colors['prime'])
                Rectangle:
                    pos: self.pos
                    size: self.size

<ResultsScreen>
    name: 'results'
    FloatLayout:
        Image:
            source: 'images/tabletop1.jpg'
            allow_stretch: True
            keep_ratio: False
        Button:
            text: 'Play again?'
            size_hint: (.15, .05)
            pos_hint: {'x': .45, 'y': .2}
            on_press: root.play_again()
        Button:
            text: 'Exit'
            size_hint: (.15, .05)
            pos_hint: {'x': .45, 'y': .09}
            on_press: root.exit()

<PlayerNameScreen>
    name: 'name'
    FloatLayout:
        Image:
            source: 'images/tabletop4.jpg'
            allow_stretch: True
            keep_ratio: False

<ButtonLabel>
    font_size: 50
    color: rgba(colors['text'])
    on_touch_up: root.parent.current = 'name'
    canvas.before:
        Color:
            rgba: rgba(colors['prime'])
        Rectangle:
            pos: self.pos
            size: (self.size[0] + 5, self.size[1] + 5)

<PlayerNumberScreen>
    name: 'number'
    FloatLayout:
        Image:
            source: 'images/tabletop3.jpg'
            allow_stretch: True
            keep_ratio: False
        Label:
            text: 'How many people are playing?\nUp to three can play.'
            halign: 'center'
            font_size: 40
            color: rgba(colors['text'])
            size_hint: (.275, .075)
            pos_hint: {'x': .35, 'y': .7}
        ButtonLabel:
            text: 'Just Me!'
            pos_hint: {'x': .15, 'y': .425}
            size_hint: (.25, .075)
            on_touch_down: root.set_num_players(1)
        ButtonLabel:
            text: 'You and Me!'
            pos_hint: {'x': .525, 'y': .425}
            size_hint: (.35, .075)
            on_touch_down: root.set_num_players(2)
        ButtonLabel:
            text: 'We Three!'
            pos_hint: {'x': .32, 'y': .3}
            size_hint: (.3, .075)
            on_touch_down: root.set_num_players(3)

<DieHolder>

<KeeperBox>

<DieBasket>
    keeper_box: keeper_box
    size_hint: 1, 0.4
    pos_hint: {'x': 0.0, 'y': 0.6}
    canvas.after:
        Color:
            rgba: root.valid_basket
        Rectangle:
            pos: self.x, self.y
            size: self.width, self.x + 2
    Label:
        text: 'Put Keepers Up Here'
        font_size: 18
        bold: True
        color: rgba(colors['text'])
        halign: 'center'
        pos_hint: {'x': self.x, 'y': -.425}
    KeeperBox:
        id: keeper_box
        pos_hint: {'x': 0, 'y': 0.33}
        size_hint: 1, 0.4
        padding: [5]
        spacing: 5
        DieHolder:
            id: '1'
        DieHolder:
            id: '2'
        DieHolder:
            id: '3'
        DieHolder:
            id: '4'
        DieHolder:
            id: '5'
        DieHolder:
            id: '6'

<Roll>
    text: 'Roll \'em!'
    color: rgba(colors['text'])
    size_hint: (0.2, 0.1)
    pos_hint: {'x': 0.15, 'y': 0.05}
    font_size: 35
    canvas.before:
        Color:
            rgba: rgba(colors['prime'])
        Rectangle:
            pos: self.pos[0] + 7, self.pos[1] + 7
            size: self.texture_size[0] + 10, self.texture_size[1] + 5

<EndTurn>
    text: 'Keep/End Turn'
    color: rgba(colors['text'])
    size_hint: (.325, .1)
    pos_hint: {'x': .45, 'y': .05}
    font_size: 35
    canvas.before:
        Color:
            rgba: rgba(colors['prime'])
        Rectangle:
            pos: self.pos[0] + 7, self.pos[1] + 7
            size: self.texture_size[0] + 10, self.texture_size[1] + 5

<Base>
    Image:
        source: 'images/tabletop2.jpg'
        allow_stretch: True
        keep_ratio: False

<PlayerScore>
    size_hint: (1, 0.15)
    pos_hint: {'x': 0., 'y': .9}
    canvas:
        Color:
            rgba: rgba(colors['prime dark'])
        Rectangle:
            pos: self.pos
            size: self.size

<GameScreen>
    name: 'game'
    base: base
    Base:
        player_score: player_score
        die_basket: die_basket
        dice: dice
        end_turn: end_turn
        roll: roll
        id: base
        PlayerScore:
            id: player_score
        DieBasket:
            id: die_basket
            active_game: root.active_game
        Dice:
            id: dice
        EndTurn:
            id: end_turn
        Roll:
            id: roll
