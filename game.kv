# Copyright 2018 Paul Kutrich. All rights reserved.
#:kivy 1.10.1
#: import ScreenManager kivy.uix.screenmanager.ScreenManager
#: import colors colors.colors
#: import rgba kivy.utils.rgba
#: import FallOutTransition kivy.uix.screenmanager.FallOutTransition
#: import CardTransition kivy.uix.screenmanager.CardTransition
#: import SwapTransition kivy.uix.screenmanager.SwapTransition

ScreenManager:
    id: screen_manager
    transition: FallOutTransition()
    MenuScreen:
        id: menu
        name: 'menu'
        manager: 'screen_manager'
    PlayerNumberScreen:
        id: player_number
        name: 'number'
        manager: 'screen_manager'
    PlayerNameScreen:
        id: name
        name: 'name'
        manager: 'screen_manager'
    GameScreen:
        id: game
        name: 'game'
        manager: 'screen_manager'
    SoloGoalScreen:
        id: goal
        name: 'goal'
        manager: 'screen_manger'
    SoloGameScreen:
        id: solo
        name: 'solo'
        manager: 'screen_manager'
    ResultsScreen:
        id: results
        name: 'results'
        manager: 'screen_manager'

<SoloGameButton>:

<Background@Image>:
    source: 'images/tabletop4.jpg'
    allow_stretch: True
    keep_ratio: False

<MenuScreen>:
    name: 'menu'
    FloatLayout:
        Background:
        Label:
            text: 'Welcome to Ten Thousand!'
            font_size: 35
            color: rgba(colors['text'])
            size_hint: .4, .1
            pos_hint: {'x': .295, 'y': .65}
        Label:
            text: 'A dice game'
            font_size: 20
            color: rgba(colors['text'])
            size_hint: .2, .1
            pos_hint: {'x': .4, 'y': .575}
        Button:
            text: 'Play With Friends!'
            color: rgba(colors['text'])
            font_size: 35
            size_hint: .47, .1
            pos_hint: {'x': 0.25, 'y': 0.45}
            on_press: root.parent.current = 'number'
            background_normal: ''
            background_color: rgba(colors['prime dark'])
        SoloGameButton:
            text: 'Solo Challenge!'
            color: rgba(colors['text'])
            font_size: 35
            size_hint: .47, .1
            pos_hint: {'x': 0.25, 'y': 0.3}
            background_normal: ''
            background_color: rgba(colors['prime dark'])


<ResultsScreen>:
    name: 'results'
    Background:
    BoxLayout:
        size_hint: .5, .15
        pos_hint: {'x': .25, 'y': .2}
        spacing: 5
        padding: [5]
        Button:
            text: 'Play again?'
            on_press: root.play_again()
            background_normal: ''
            background_color: rgba(colors['second dark'])
        Button:
            text: 'Exit'
            on_press: root.exit()
            background_normal: ''
            background_color: rgba(colors['second dark'])

<PlayerNameScreen>:
    name: 'name'
    Background:

<PlayerNumButton>:
    color: rgba(colors['text'])
    font_size: 50
    halign: 'center'
    background_normal: ''
    background_color: rgba(colors['prime dark'])

<PlayerNumberScreen>:
    num_label: num_label
    cont: cont
    name: 'number'
    Background:
    Label:
        text: 'How many people are playing?'
        halign: 'center'
        font_size: 40
        color: rgba(colors['text'])
        size_hint: (.275, .075)
        pos_hint: {'x': .35, 'y': .8}
    Label:
        id: num_label
        text: 'Players Selected: '
        font_size: 30
        size_hint: .2, .1
        pos_hint: {'x': .4, 'y': .15}
    Button:
        id: cont
        size_hint: .2, .1
        pos_hint: {'x': .4, 'y': .05}
        text: 'Continue'
        font_size: 30
        background_normal: ''
        background_color: rgba(colors['second dark'])
        on_release: root.parent.current = 'name'
        disabled: True

<DieHolder>:

<KeeperBox>:

<DieBasket>:
    keeper_box: keeper_box
    size_hint: .7, 0.4
    pos_hint: {'x': 0.0, 'y': 0.7}
    canvas.after:
        Color:
            rgba: root.valid_basket
        Rectangle:
            pos: self.x, self.y
            size: self.width, self.x + 3
    Label:
        text: 'Drag Dice To Line Or Double Click To Score'
        font_size: 18
        bold: True
        #color: rgba(colors['text'])
        halign: 'center'
        pos_hint: {'x': self.x, 'y': -0.425}
    KeeperBox:
        id: keeper_box
        pos_hint: {'x': 0, 'y': 0.125}
        size_hint: 1, 0.4
        padding: [5]
        spacing: 5
        DieHolder:
        DieHolder:
        DieHolder:
        DieHolder:
        DieHolder:
        DieHolder:

<PlayerArea@Label>:
    font_size: 22
    color: rgba(colors['text'])
    canvas.before:
        Color:
            rgba: rgba(colors['prime dark'])
        Rectangle:
            pos: self.pos
            size: self.size

<PlayerScore>:
    name: name
    round: round
    total: total
    total_plus: total_plus
    PlayerArea:
        id: name
        text_size: self.width, None
        size_hint: .8, 1
        shorten: True
        shorten_from: 'right'
        halign: 'center'
    PlayerArea:
        id: round
        size_hint: .55, 1
        halign: 'left'
    PlayerArea:
        id: total
        size_hint: .6, 1
        halign: 'left'
    PlayerArea:
        id: total_plus
        size_hint: .85, 1
        halign: 'left'

<InformationStation>:
    box: box
    orientation: 'vertical'
    size_hint: .3, 1
    pos_hint: {'x': .7, 'y': 0}
    padding: [1]
    spacing: 5
    canvas:
        Color:
            rgba: rgba(colors['second'])
        Rectangle:
            size: root.size
            pos: root.pos
    Label:
        text: 'Player Totals'
        font_size: 25
        size_hint: .95, .1
        pos_hint: {'x': .025, 'y': .875}
        canvas.before:
            Color:
                rgba: rgba(colors['second light'])
            Rectangle
                size: self.size
                pos: self.pos
    BoxLayout:
        id: box
        size_hint: 1, .6
        pos_hint: {'x': .05, 'y': .2}
        orientation: 'vertical'
    RulesButton:
        size_hint: .95, .1
        pos_hint: {'x': .025, 'y': .025}

<ScoreArea>:
    size_hint: .7, 0.1
    pos_hint: {'x': 0, 'y': 0.9}
    spacing: 4
    padding: [4]

<Roll>:
    text: 'Roll \'em!'
    color: rgba(colors['text'])
    font_size: 35
    background_normal: ''
    background_color: rgba(colors['second dark'])

<EndTurn>:
    text: 'Keep Points\nEnd Turn'
    color: rgba(colors['text'])
    halign: 'center'
    font_size: 25
    background_normal: ''
    background_color: rgba(colors['second dark'])

<KeepAll>:
    text: 'Select All'
    color: rgba(colors['text'])
    font_size: 35
    background_normal: ''
    background_color: rgba(colors['second dark'])

<RulesButton>:
    text: 'See Rules'
    color: rgba(colors['text'])
    font_size: 35
    background_normal: ''
    background_color: rgba(colors['second dark'])

<GameButtonRow>:
    size_hint: .7, .15
    pos_hint: {'x': 0, 'y': 0}
    padding: [10]
    spacing: 10

<Base>:
    score_area: score_area
    die_basket: die_basket
    dice: dice
    buttons: buttons
    info: info
    Background:
    InformationStation:
        id: info
        active_game: root.active_game
    ScoreArea:
        id: score_area
    DieBasket:
        id: die_basket
        active_game: root.active_game
    Dice:
        id: dice
        size_hint: .7, None
    GameButtonRow:
        id: buttons
        roll: roll
        end_turn: end_turn
        keep: keep
        Roll:
            id: roll
        KeepAll:
            id: keep
        EndTurn:
            id: end_turn

<GameScreen>:
    name: 'game'
    base: base
    Base:
        id: base

<SoloGoalScreen>:
    name: 'goal'
    goals: goals
    cont: cont
    Background:
    BoxLayout:
        id: goals
        points: points
        turns: turns
        diff: diff
        size_hint: .95, .1
        pos_hint: {'x': .025, 'y': .2}
        padding: [5]
        spacing: 5
        Label:
            id: points
            font_size: 30
            halign: 'left'
            text: 'Points goal:'
        Label
            id: turns
            font_size: 30
            text: 'Turn limit:'
        Label
            id: diff
            font_size: 30
            text: 'Difficulty:'
    Button:
        id: cont
        size_hint: .2, .1
        pos_hint: {'x': .4, 'y': .05}
        text: 'Continue'
        font_size: 30
        background_normal: ''
        background_color: rgba(colors['second dark'])
        on_release: root.parent.current = 'name'
        disabled: True

<SoloPlayerScore>:
    name: name
    round: round
    total_plus: total_plus
    progress: progress
    PlayerArea:
        id: name
        text_size: self.width, None
        size_hint: .4, 1
        shorten: True
        shorten_from: 'right'
        halign: 'center'
    PlayerArea:
        id: round
        size_hint: .3, 1
        halign: 'left'
    PlayerArea:
        id: total_plus
        size_hint: .5, 1
        halign: 'left'
    PlayerArea:
        id: progress
        size_hint: .3, 1
        halign: 'left'

<SoloGameScreen>:
    name: 'solo'
    base: base
    Base:
        id: base
