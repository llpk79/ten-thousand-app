# Copyright 2018 Paul Kutrich. All rights reserved.
#:kivy 1.10.1
#: import ScreenManager kivy.uix.screenmanager.ScreenManager
#: import colors colors.colors
#: import rgba kivy.utils.rgba
#: import FallOutTransition kivy.uix.screenmanager.FallOutTransition
#: import CardTransition kivy.uix.screenmanager.CardTransition
#: import SwapTransition kivy.uix.screenmanager.SwapTransition

ScreenManager:
    id: screen_manager
    transition: FallOutTransition()
    MenuScreen:
        id: menu
        name: 'menu'
        manager: 'screen_manager'
    PlayerNumberScreen:
        id: player_number
        name: 'number'
        manager: 'screen_manager'
    PlayerNameScreen:
        id: name
        name: 'name'
        manager: 'screen_manager'
    GameScreen:
        id: game
        name: 'game'
        manager: 'screen_manager'
    ResultsScreen:
        id: results
        name: 'results'
        manager: 'screen_manager'

<MenuScreen>:
    name: 'menu'
    FloatLayout:
        Image:
            source: 'images/tabletop4.jpg'
            allow_stretch: True
            keep_ratio: False
        Label:
            text: 'Welcome to Ten Thousand!'
            font_size: 35
            color: rgba(colors['text'])
            size_hint: .4, .1
            pos_hint: {'x': .3, 'y': .6}
        Label:
            text: 'A dice game'
            font_size: 20
            color: rgba(colors['text'])
            size_hint: .2, .1
            pos_hint: {'x': .4, 'y': .55}
        Button:
            text: 'Let\'s play some dice!'
            color: rgba(colors['text'])
            font_size: 35
            size_hint: .47, .1
            pos_hint: {'x': 0.25, 'y': 0.45}
            on_press: root.parent.current = 'number'
            background_normal: ''
            background_color: rgba(colors['prime dark'])

<ResultsScreen>:
    name: 'results'
    FloatLayout:
        Image:
            source: 'images/tabletop4.jpg'
            allow_stretch: True
            keep_ratio: False
        Button:
            text: 'Play again?'
            size_hint: (.15, .05)
            pos_hint: {'x': .45, 'y': .2}
            on_press: root.play_again()
        Button:
            text: 'Exit'
            size_hint: (.15, .05)
            pos_hint: {'x': .45, 'y': .09}
            on_press: root.exit()

<PlayerNameScreen>:
    name: 'name'
    FloatLayout:
        Image:
            source: 'images/tabletop4.jpg'
            allow_stretch: True
            keep_ratio: False

<PlayerNumButton@Button>:
    color: rgba(colors['text'])
    font_size: 50
    halign: 'center'
    background_normal: ''
    background_color: rgba(colors['prime dark'])

<PlayerNumberScreen>:
    name: 'number'
    layout: layout
    FloatLayout:
        buttons: buttons
        id: layout
        Image:
            source: 'images/tabletop4.jpg'
            allow_stretch: True
            keep_ratio: False
        Label:
            text: 'How many people are playing?\nUp to three can play.'
            halign: 'center'
            font_size: 40
            color: rgba(colors['text'])
            size_hint: (.275, .075)
            pos_hint: {'x': .35, 'y': .7}
        BoxLayout:
            one: one
            two: two
            three: three
            id: buttons
            size_hint: .8, .2
            pos_hint: {'x': .1, 'y': .4}
            spacing: 5
            padding: [5]
            PlayerNumButton:
                id: one
                text: 'One'
            PlayerNumButton:
                id: two
                text: 'Two'
            PlayerNumButton:
                id: three
                text: 'Three'

<DieHolder>:

<KeeperBox>:

<DieBasket>:
    keeper_box: keeper_box
    size_hint: 1, 0.4
    pos_hint: {'x': 0.0, 'y': 0.7}
    canvas.after:
        Color:
            rgba: root.valid_basket
        Rectangle:
            pos: self.x, self.y
            size: self.width, self.x + 3
    Label:
        text: 'Drag Dice To Line Or Double Click To Score'
        font_size: 18
        bold: True
        #color: rgba(colors['text'])
        halign: 'center'
        pos_hint: {'x': self.x, 'y': -0.425}
    KeeperBox:
        id: keeper_box
        pos_hint: {'x': 0, 'y': 0.1}
        size_hint: 1, 0.4
        padding: [5]
        spacing: 5
        DieHolder:
        DieHolder:
        DieHolder:
        DieHolder:
        DieHolder:
        DieHolder:

<PlayerScore>:

<ScoreArea>:
    size_hint: 1, 0.1
    pos_hint: {'x': 0, 'y': 0.9}
    canvas:
        Color:
            rgba: rgba(colors['prime dark'])
        Rectangle:
            pos: self.pos
            size: self.size

<Roll>:
    text: 'Roll \'em!'
    color: rgba(colors['text'])
    font_size: 35
    background_normal: ''
    background_color: rgba(colors['second dark'])

<EndTurn>:
    text: 'End Turn'
    color: rgba(colors['text'])
    font_size: 35
    background_normal: ''
    background_color: rgba(colors['second dark'])

<KeepAll>:
    text: 'Keep All'
    color: rgba(colors['text'])
    font_size: 35
    background_normal: ''
    background_color: rgba(colors['second dark'])

<RulesButton>:
    text: 'See Rules'
    color: rgba(colors['text'])
    font_size: 35
    background_normal: ''
    background_color: rgba(colors['second dark'])

<GameButtonRow>:
    size_hint: 1, .15
    pos_hint: {'x': 0, 'y': 0}
    padding: [10]
    spacing: 10

<Base>:
    score_area: score_area
    die_basket: die_basket
    dice: dice
    buttons: buttons
    Image:
        source: 'images/tabletop4.jpg'
        allow_stretch: True
        keep_ratio: False
    ScoreArea:
        id: score_area
    DieBasket:
        id: die_basket
        active_game: root.parent.active_game
    Dice:
        id: dice
    GameButtonRow:
        id: buttons
        roll: roll
        end_turn: end_turn
        keep: keep
        rules: rules
        Roll:
            id: roll
        EndTurn:
            id: end_turn
        KeepAll:
            id: keep
        RulesButton:
            id: rules


<GameScreen>:
    name: 'game'
    base: base
    Base:
        id: base
